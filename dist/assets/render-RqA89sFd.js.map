{"version":3,"file":"render-RqA89sFd.js","sources":["../../src/shaders/index.ts","../../src/render/RenderPipeline.ts"],"sourcesContent":["/**\n * Grok Zephyr - Shader Collection\n * \n * Central export for all WGSL shaders.\n * In a production build, these would be imported as strings\n * via a custom Vite plugin.\n */\n\n// For now, we use inline strings that match the .wgsl files\n// In a full implementation, these would be loaded via:\n// import orbitalCompute from './orbital_compute.wgsl?raw';\n\n/** Uniform struct shared across shaders */\nexport const UNIFORM_STRUCT = /* wgsl */ `\nstruct Uni {\n  view_proj      : mat4x4f,\n  camera_pos     : vec4f,\n  camera_right   : vec4f,\n  camera_up      : vec4f,\n  time           : f32,\n  delta_time     : f32,\n  view_mode      : u32,\n  pad0           : u32,\n  frustum        : array<vec4f,6>,\n  screen_size    : vec2f,\n  pad1           : vec2f,\n};\n@group(0) @binding(0) var<uniform> uni : Uni;\n`;\n\n/** Orbital mechanics compute shader */\nexport const ORBITAL_CS = UNIFORM_STRUCT + /* wgsl */ `\n@group(0) @binding(1) var<storage,read>       orb_elem : array<vec4f>;\n@group(0) @binding(2) var<storage,read_write> sat_pos  : array<vec4f>;\n\nconst ORBIT_KM    : f32 = 6921.0;\nconst MEAN_MOTION : f32 = 0.001097;\n\n@compute @workgroup_size(64,1,1)\nfn main(@builtin(global_invocation_id) gid : vec3u) {\n  let i = gid.x;\n  if (i >= 1048576u) { return; }\n\n  let e    = orb_elem[i];\n  let raan = e.x;\n  let inc  = e.y;\n  let m0   = e.z;\n  let cdat = e.w;\n\n  let M  = m0 + MEAN_MOTION * uni.time;\n  let cM = cos(M); let sM = sin(M);\n  let cR = cos(raan); let sR = sin(raan);\n  let cI = cos(inc);  let sI = sin(inc);\n\n  let x = ORBIT_KM * (cR*cM - sR*sM*cI);\n  let y = ORBIT_KM * (sR*cM + cR*sM*cI);\n  let z = ORBIT_KM * sM * sI;\n\n  sat_pos[i] = vec4f(x, y, z, cdat);\n}\n`;\n\n/** Starfield background shader */\nexport const STARS_SHADER = UNIFORM_STRUCT + /* wgsl */ `\nstruct VSOut { @builtin(position) pos:vec4f, @location(0) uv:vec2f };\n\n@vertex fn vs(@builtin(vertex_index) vi:u32) -> VSOut {\n  const pts = array<vec2f,3>(vec2f(-1,-1),vec2f(3,-1),vec2f(-1,3));\n  var o:VSOut;\n  o.pos = vec4f(pts[vi],0,1);\n  o.uv  = pts[vi]*0.5 + 0.5;\n  return o;\n}\n\nfn hash2(p:vec2f)->f32 {\n  return fract(sin(dot(p,vec2f(127.1,311.7)))*43758.5453);\n}\n\n@fragment fn fs(in:VSOut) -> @location(0) vec4f {\n  let cell  = floor(in.uv * 512.0);\n  let h     = hash2(cell);\n  let h2    = hash2(cell + vec2f(1.0,0.0));\n  let h3    = hash2(cell + vec2f(0.0,1.0));\n  let star  = f32(h > 0.994) * pow(h2,6.0);\n  let color = mix(vec3f(0.6,0.8,1.0), vec3f(1.0,0.9,0.7), h3);\n  return vec4f(color * star * 1.5, 1.0);\n}\n`;\n\n/** Earth sphere shader */\nexport const EARTH_SHADER = UNIFORM_STRUCT + /* wgsl */ `\nstruct VIn  { @location(0) pos:vec3f, @location(1) nrm:vec3f }\nstruct VOut { @builtin(position) cp:vec4f, @location(0) wp:vec3f, @location(1) n:vec3f }\n\n@vertex fn vs(v:VIn) -> VOut {\n  var o:VOut;\n  o.cp = uni.view_proj * vec4f(v.pos,1);\n  o.wp = v.pos;\n  o.n  = v.nrm;\n  return o;\n}\n\n@fragment fn fs(in:VOut) -> @location(0) vec4f {\n  let N       = normalize(in.n);\n  let sun_dir = normalize(vec3f(1.0,0.4,0.2));\n  let diff    = max(dot(N,sun_dir),0.0);\n\n  let lat = asin(clamp(N.z,-1.0,1.0));\n  let lon = atan2(N.y,N.x);\n  let f1  = sin(lat*4.0+0.5)*cos(lon*3.0+1.2);\n  let f2  = cos(lat*6.0)*sin(lon*5.0+0.8);\n  let land = smoothstep(0.15,0.35, f1*0.6+f2*0.4);\n\n  let ocean = vec3f(0.04,0.10,0.30);\n  let soil  = vec3f(0.15,0.22,0.06);\n  let ice   = vec3f(0.7,0.75,0.8);\n  let pole  = smoothstep(1.1,1.4, abs(lat));\n  var surf  = mix(mix(ocean,soil,land), ice, pole);\n\n  let ambient   = 0.04;\n  let lit       = surf * (diff*0.92 + ambient);\n\n  let night = smoothstep(0.08,-0.08,dot(N,sun_dir));\n  let city  = night * 0.025 * vec3f(1.0,0.85,0.4)\n              * smoothstep(0.4,0.6,land)\n              * (0.5+0.5*sin(lon*18.0+lat*14.0));\n\n  return vec4f(lit+city,1.0);\n}\n`;\n\n/** Atmosphere limb glow shader */\nexport const ATM_SHADER = UNIFORM_STRUCT + /* wgsl */ `\nstruct VIn  { @location(0) pos:vec3f, @location(1) nrm:vec3f }\nstruct VOut { @builtin(position) cp:vec4f, @location(0) wp:vec3f, @location(1) n:vec3f }\n\nconst ATM_SCALE : f32 = 6471.0/6371.0;\n\n@vertex fn vs(v:VIn) -> VOut {\n  var o:VOut;\n  let p  = v.pos * ATM_SCALE;\n  o.cp   = uni.view_proj * vec4f(p,1);\n  o.wp   = p;\n  o.n    = v.nrm;\n  return o;\n}\n\n@fragment fn fs(in:VOut) -> @location(0) vec4f {\n  let N       = normalize(in.n);\n  let V       = normalize(uni.camera_pos.xyz - in.wp);\n  let rim     = 1.0 - abs(dot(N,V));\n  let limb    = pow(rim,3.5);\n  let limb2   = pow(rim,7.0);\n\n  let blue    = vec3f(0.08,0.38,1.0)*limb*2.8;\n  let teal    = vec3f(0.0,0.7,0.45)*limb2*0.6;\n  let alpha   = limb*0.85;\n  return vec4f(blue+teal, alpha);\n}\n`;\n\n/** Satellite billboard shader */\nexport const SAT_SHADER = UNIFORM_STRUCT + /* wgsl */ `\n@group(0) @binding(1) var<storage,read> sat_pos : array<vec4f>;\n\nstruct VOut {\n  @builtin(position) cp : vec4f,\n  @location(0) uv       : vec2f,\n  @location(1) color    : vec3f,\n  @location(2) bright   : f32,\n}\n\nfn sat_color(idx:u32) -> vec3f {\n  let c = idx % 7u;\n  if(c==0u){return vec3f(1.0,0.18,0.18);}\n  if(c==1u){return vec3f(0.18,1.0,0.18);}\n  if(c==2u){return vec3f(0.25,0.45,1.0);}\n  if(c==3u){return vec3f(1.0,1.0,0.1);}\n  if(c==4u){return vec3f(0.1,1.0,1.0);}\n  if(c==5u){return vec3f(1.0,0.1,1.0);}\n  return vec3f(1.0,1.0,1.0);\n}\n\n@vertex fn vs(\n  @builtin(vertex_index)   vi : u32,\n  @builtin(instance_index) ii : u32,\n) -> VOut {\n  let pd      = sat_pos[ii];\n  let wp      = pd.xyz;\n  let cdat    = pd.w;\n  let cam     = uni.camera_pos.xyz;\n  let dist    = length(wp - cam);\n\n  var visible = true;\n  if (dist > 14000.0) { visible = false; }\n  if (visible) {\n    for (var p=0u; p<6u; p++) {\n      let pl = uni.frustum[p];\n      if (dot(pl.xyz, wp) + pl.w < -200.0) { visible=false; break; }\n    }\n  }\n\n  var o : VOut;\n  if (!visible) {\n    o.cp     = vec4f(10,10,10,1);\n    o.uv     = vec2f(0);\n    o.color  = vec3f(0);\n    o.bright = 0.0;\n    return o;\n  }\n\n  let bsize = clamp(1200.0/max(dist,50.0), 0.4, 60.0);\n\n  const quad = array<vec2f,6>(\n    vec2f(-1,-1),vec2f(1,-1),vec2f(-1,1),\n    vec2f(-1, 1),vec2f(1,-1),vec2f( 1,1));\n\n  let qv     = quad[vi];\n  let right  = uni.camera_right.xyz;\n  let up     = uni.camera_up.xyz;\n  let offset = (qv.x*right + qv.y*up) * bsize;\n  let fpos   = wp + offset;\n\n  let cidx    = u32(abs(cdat)) % 7u;\n  let col     = sat_color(cidx);\n  let phase   = cdat*0.15 + uni.time*(0.8+0.4*fract(f32(ii)*0.000613));\n  let pattern = 0.35 + 0.65*(0.5 + 0.5*sin(phase));\n\n  let atten   = 1.0/(1.0 + dist*0.00075);\n  let bright  = pattern * atten;\n\n  o.cp     = uni.view_proj * vec4f(fpos,1);\n  o.uv     = (qv + 1.0)*0.5;\n  o.color  = col;\n  o.bright = bright;\n  return o;\n}\n\n@fragment fn fs(in:VOut) -> @location(0) vec4f {\n  let d     = length(in.uv - 0.5)*2.0;\n  if (d > 1.0) { discard; }\n  let ring  = 1.0 - smoothstep(0.55,1.0,d);\n  let core  = 1.0 - smoothstep(0.0,0.22,d);\n  let alpha = ring * in.bright;\n  let hdr   = in.color * (ring + core*2.2) * in.bright * 2.8;\n  return vec4f(hdr, alpha);\n}\n`;\n\n/** Bloom threshold shader */\nexport const BLOOM_THRESHOLD_SHADER = /* wgsl */ `\n@group(0) @binding(0) var tex : texture_2d<f32>;\n@group(0) @binding(1) var smp : sampler;\n\nstruct VSOut { @builtin(position) pos:vec4f, @location(0) uv:vec2f }\n\n@vertex fn vs(@builtin(vertex_index) vi:u32) -> VSOut {\n  const pts = array<vec2f,3>(vec2f(-1,-1),vec2f(3,-1),vec2f(-1,3));\n  var o:VSOut; o.pos=vec4f(pts[vi],0,1); o.uv=pts[vi]*0.5+0.5; return o;\n}\n\n@fragment fn fs(in:VSOut) -> @location(0) vec4f {\n  var uv = in.uv; uv.y = 1.0-uv.y;\n  let c   = textureSample(tex,smp,uv).rgb;\n  let lum = dot(c,vec3f(0.2126,0.7152,0.0722));\n  let t   = smoothstep(0.75,1.4,lum);\n  return vec4f(c*t,1.0);\n}\n`;\n\n/** Bloom blur shader */\nexport const BLOOM_BLUR_SHADER = /* wgsl */ `\nstruct BlurUni { texel:vec2f, horizontal:u32, pad:u32 }\n@group(0) @binding(0) var<uniform> buni : BlurUni;\n@group(0) @binding(1) var tex : texture_2d<f32>;\n@group(0) @binding(2) var smp : sampler;\n\nstruct VSOut { @builtin(position) pos:vec4f, @location(0) uv:vec2f }\n\n@vertex fn vs(@builtin(vertex_index) vi:u32) -> VSOut {\n  const pts = array<vec2f,3>(vec2f(-1,-1),vec2f(3,-1),vec2f(-1,3));\n  var o:VSOut; o.pos=vec4f(pts[vi],0,1); o.uv=pts[vi]*0.5+0.5; return o;\n}\n\n@fragment fn fs(in:VSOut) -> @location(0) vec4f {\n  var uv = in.uv; uv.y = 1.0-uv.y;\n  let d  = select(vec2f(0,buni.texel.y), vec2f(buni.texel.x,0), buni.horizontal != 0u);\n  const W = array<f32,5>(0.2270,0.1945,0.1216,0.0540,0.0162);\n  var c   = textureSample(tex,smp,uv).rgb * W[0];\n  for (var i=1; i<5; i++) {\n    let off = f32(i)*d;\n    c += textureSample(tex,smp,uv+off).rgb * W[i];\n    c += textureSample(tex,smp,uv-off).rgb * W[i];\n  }\n  return vec4f(c,1.0);\n}\n`;\n\n/** Composite + tonemapping shader */\nexport const COMPOSITE_SHADER = /* wgsl */ `\n@group(0) @binding(0) var scene_tex : texture_2d<f32>;\n@group(0) @binding(1) var bloom_tex : texture_2d<f32>;\n@group(0) @binding(2) var smp       : sampler;\n\nstruct VSOut { @builtin(position) pos:vec4f, @location(0) uv:vec2f }\n\n@vertex fn vs(@builtin(vertex_index) vi:u32) -> VSOut {\n  const pts = array<vec2f,3>(vec2f(-1,-1),vec2f(3,-1),vec2f(-1,3));\n  var o:VSOut; o.pos=vec4f(pts[vi],0,1); o.uv=pts[vi]*0.5+0.5; return o;\n}\n\nfn aces(x:vec3f)->vec3f {\n  let a=2.51; let b=0.03; let c=2.43; let d=0.59; let e=0.14;\n  return clamp((x*(a*x+b))/(x*(c*x+d)+e),vec3f(0),vec3f(1));\n}\n\n@fragment fn fs(in:VSOut) -> @location(0) vec4f {\n  var uv = in.uv; uv.y = 1.0-uv.y;\n  let scene = textureSample(scene_tex,smp,uv).rgb;\n  let bloom = textureSample(bloom_tex,smp,uv).rgb;\n  let hdr   = scene + bloom*1.8;\n  return vec4f(aces(hdr),1.0);\n}\n`;\n\n/** Export all shaders as a collection */\nexport const SHADERS = {\n  orbital: ORBITAL_CS,\n  stars: STARS_SHADER,\n  earth: EARTH_SHADER,\n  atmosphere: ATM_SHADER,\n  satellites: SAT_SHADER,\n  bloomThreshold: BLOOM_THRESHOLD_SHADER,\n  bloomBlur: BLOOM_BLUR_SHADER,\n  composite: COMPOSITE_SHADER,\n} as const;\n\nexport default SHADERS;\n","/**\n * Grok Zephyr - Render Pipeline\n * \n * Manages the 6-pass rendering pipeline:\n * 1. Compute orbital positions\n * 2. Scene pass (stars, Earth, atmosphere, satellites)\n * 3. Bloom threshold\n * 4. Bloom horizontal blur\n * 5. Bloom vertical blur\n * 6. Composite + tonemapping\n */\n\nimport type WebGPUContext from '@/core/WebGPUContext.js';\nimport type { SatelliteBufferSet } from '@/core/SatelliteGPUBuffer.js';\nimport { SHADERS } from '@/shaders/index.js';\nimport { CONSTANTS, RENDER } from '@/types/constants.js';\n\n/** Render targets for HDR pipeline */\nexport interface RenderTargets {\n  hdr: GPUTexture;\n  depth: GPUTexture;\n  bloomA: GPUTexture;\n  bloomB: GPUTexture;\n  \n  // Cached views\n  hdrView: GPUTextureView;\n  depthView: GPUTextureView;\n  bloomAView: GPUTextureView;\n  bloomBView: GPUTextureView;\n}\n\n/** Pipeline bind groups */\nexport interface PipelineBindGroups {\n  compute: GPUBindGroup;\n  stars: GPUBindGroup;\n  earth: GPUBindGroup;\n  atmosphere: GPUBindGroup;\n  satellites: GPUBindGroup;\n  bloomThreshold: GPUBindGroup;\n  bloomHorizontal: GPUBindGroup;\n  bloomVertical: GPUBindGroup;\n  composite: GPUBindGroup;\n}\n\n/** All render pipelines */\nexport interface Pipelines {\n  compute: GPUComputePipeline;\n  stars: GPURenderPipeline;\n  earth: GPURenderPipeline;\n  atmosphere: GPURenderPipeline;\n  satellites: GPURenderPipeline;\n  bloomThreshold: GPURenderPipeline;\n  bloomBlur: GPURenderPipeline;\n  composite: GPURenderPipeline;\n}\n\n/**\n * Render Pipeline Manager\n * \n * Encapsulates all rendering logic for the 6-pass pipeline.\n */\nexport class RenderPipeline {\n  private context: WebGPUContext;\n  private buffers: SatelliteBufferSet;\n  private linearSampler: GPUSampler;\n  \n  private pipelines: Pipelines | null = null;\n  private bindGroups: PipelineBindGroups | null = null;\n  private renderTargets: RenderTargets | null = null;\n  \n  private width = 0;\n  private height = 0;\n\n  constructor(context: WebGPUContext, buffers: SatelliteBufferSet) {\n    this.context = context;\n    this.buffers = buffers;\n    this.linearSampler = context.createLinearSampler();\n  }\n\n  /**\n   * Initialize all pipelines and render targets\n   */\n  initialize(width: number, height: number): void {\n    this.width = width;\n    this.height = height;\n    \n    console.log(`[RenderPipeline] Initializing ${width}x${height}`);\n    \n    this.createPipelines();\n    this.createRenderTargets(width, height);\n    this.createBindGroups();\n    \n    console.log('[RenderPipeline] Initialization complete');\n  }\n\n  /**\n   * Create all shader pipelines\n   */\n  private createPipelines(): void {\n    const device = this.context.getDevice();\n    \n    // Compute pipeline layout\n    const computeLayout = device.createPipelineLayout({\n      bindGroupLayouts: [\n        device.createBindGroupLayout({\n          entries: [\n            { binding: 0, visibility: GPUShaderStage.COMPUTE, buffer: { type: 'uniform' } },\n            { binding: 1, visibility: GPUShaderStage.COMPUTE, buffer: { type: 'read-only-storage' } },\n            { binding: 2, visibility: GPUShaderStage.COMPUTE, buffer: { type: 'storage' } },\n          ],\n        }),\n      ],\n    });\n\n    // Uniform-only render layout\n    const uniformLayout = device.createBindGroupLayout({\n      entries: [\n        { binding: 0, visibility: GPUShaderStage.VERTEX | GPUShaderStage.FRAGMENT, buffer: { type: 'uniform' } },\n      ],\n    });\n\n    // Uniform + storage render layout\n    const uniformStorageLayout = device.createBindGroupLayout({\n      entries: [\n        { binding: 0, visibility: GPUShaderStage.VERTEX | GPUShaderStage.FRAGMENT, buffer: { type: 'uniform' } },\n        { binding: 1, visibility: GPUShaderStage.VERTEX, buffer: { type: 'read-only-storage' } },\n      ],\n    });\n\n    // Bloom layout\n    const bloomLayout = device.createBindGroupLayout({\n      entries: [\n        { binding: 0, visibility: GPUShaderStage.FRAGMENT, buffer: { type: 'uniform' } },\n        { binding: 1, visibility: GPUShaderStage.FRAGMENT, texture: { sampleType: 'float' } },\n        { binding: 2, visibility: GPUShaderStage.FRAGMENT, sampler: { type: 'filtering' } },\n      ],\n    });\n\n    // Threshold layout\n    const thresholdLayout = device.createBindGroupLayout({\n      entries: [\n        { binding: 0, visibility: GPUShaderStage.FRAGMENT, texture: { sampleType: 'float' } },\n        { binding: 1, visibility: GPUShaderStage.FRAGMENT, sampler: { type: 'filtering' } },\n      ],\n    });\n\n    // Composite layout\n    const compositeLayout = device.createBindGroupLayout({\n      entries: [\n        { binding: 0, visibility: GPUShaderStage.FRAGMENT, texture: { sampleType: 'float' } },\n        { binding: 1, visibility: GPUShaderStage.FRAGMENT, texture: { sampleType: 'float' } },\n        { binding: 2, visibility: GPUShaderStage.FRAGMENT, sampler: { type: 'filtering' } },\n      ],\n    });\n\n    // Earth vertex buffer layout\n    const earthVertexLayout: GPUVertexBufferLayout = {\n      arrayStride: 24,\n      attributes: [\n        { shaderLocation: 0, offset: 0, format: 'float32x3' },\n        { shaderLocation: 1, offset: 12, format: 'float32x3' },\n      ],\n    };\n\n    // HDR blend state\n    const hdrBlend: GPUBlendState = {\n      color: { srcFactor: 'one', dstFactor: 'one-minus-src-alpha', operation: 'add' },\n      alpha: { srcFactor: 'one', dstFactor: 'one-minus-src-alpha', operation: 'add' },\n    };\n\n    // Additive blend state\n    const additiveBlend: GPUBlendState = {\n      color: { srcFactor: 'src-alpha', dstFactor: 'one', operation: 'add' },\n      alpha: { srcFactor: 'one', dstFactor: 'one', operation: 'add' },\n    };\n\n    // Create pipelines\n    this.pipelines = {\n      compute: device.createComputePipeline({\n        layout: computeLayout,\n        compute: {\n          module: this.context.createShaderModule(SHADERS.orbital, 'orbital'),\n          entryPoint: 'main',\n        },\n      }),\n\n      stars: device.createRenderPipeline({\n        layout: device.createPipelineLayout({ bindGroupLayouts: [uniformLayout] }),\n        vertex: {\n          module: this.context.createShaderModule(SHADERS.stars, 'stars'),\n          entryPoint: 'vs',\n        },\n        fragment: {\n          module: this.context.createShaderModule(SHADERS.stars, 'stars'),\n          entryPoint: 'fs',\n          targets: [{ format: RENDER.HDR_FORMAT }],\n        },\n        primitive: { topology: 'triangle-list' },\n        depthStencil: {\n          format: RENDER.DEPTH_FORMAT,\n          depthWriteEnabled: false,\n          depthCompare: 'always',\n        },\n      }),\n\n      earth: device.createRenderPipeline({\n        layout: device.createPipelineLayout({ bindGroupLayouts: [uniformLayout] }),\n        vertex: {\n          module: this.context.createShaderModule(SHADERS.earth, 'earth'),\n          entryPoint: 'vs',\n          buffers: [earthVertexLayout],\n        },\n        fragment: {\n          module: this.context.createShaderModule(SHADERS.earth, 'earth'),\n          entryPoint: 'fs',\n          targets: [{ format: RENDER.HDR_FORMAT }],\n        },\n        primitive: { topology: 'triangle-list', cullMode: 'back' },\n        depthStencil: {\n          format: RENDER.DEPTH_FORMAT,\n          depthWriteEnabled: true,\n          depthCompare: 'less',\n        },\n      }),\n\n      atmosphere: device.createRenderPipeline({\n        layout: device.createPipelineLayout({ bindGroupLayouts: [uniformLayout] }),\n        vertex: {\n          module: this.context.createShaderModule(SHADERS.atmosphere, 'atmosphere'),\n          entryPoint: 'vs',\n          buffers: [earthVertexLayout],\n        },\n        fragment: {\n          module: this.context.createShaderModule(SHADERS.atmosphere, 'atmosphere'),\n          entryPoint: 'fs',\n          targets: [{ format: RENDER.HDR_FORMAT, blend: additiveBlend }],\n        },\n        primitive: { topology: 'triangle-list', cullMode: 'front' },\n        depthStencil: {\n          format: RENDER.DEPTH_FORMAT,\n          depthWriteEnabled: false,\n          depthCompare: 'less',\n        },\n      }),\n\n      satellites: device.createRenderPipeline({\n        layout: device.createPipelineLayout({ bindGroupLayouts: [uniformStorageLayout] }),\n        vertex: {\n          module: this.context.createShaderModule(SHADERS.satellites, 'satellites'),\n          entryPoint: 'vs',\n        },\n        fragment: {\n          module: this.context.createShaderModule(SHADERS.satellites, 'satellites'),\n          entryPoint: 'fs',\n          targets: [{ format: RENDER.HDR_FORMAT, blend: additiveBlend }],\n        },\n        primitive: { topology: 'triangle-list' },\n        depthStencil: {\n          format: RENDER.DEPTH_FORMAT,\n          depthWriteEnabled: false,\n          depthCompare: 'less',\n        },\n      }),\n\n      bloomThreshold: device.createRenderPipeline({\n        layout: device.createPipelineLayout({ bindGroupLayouts: [thresholdLayout] }),\n        vertex: {\n          module: this.context.createShaderModule(SHADERS.bloomThreshold, 'bloom-threshold'),\n          entryPoint: 'vs',\n        },\n        fragment: {\n          module: this.context.createShaderModule(SHADERS.bloomThreshold, 'bloom-threshold'),\n          entryPoint: 'fs',\n          targets: [{ format: RENDER.HDR_FORMAT }],\n        },\n        primitive: { topology: 'triangle-list' },\n      }),\n\n      bloomBlur: device.createRenderPipeline({\n        layout: device.createPipelineLayout({ bindGroupLayouts: [bloomLayout] }),\n        vertex: {\n          module: this.context.createShaderModule(SHADERS.bloomBlur, 'bloom-blur'),\n          entryPoint: 'vs',\n        },\n        fragment: {\n          module: this.context.createShaderModule(SHADERS.bloomBlur, 'bloom-blur'),\n          entryPoint: 'fs',\n          targets: [{ format: RENDER.HDR_FORMAT }],\n        },\n        primitive: { topology: 'triangle-list' },\n      }),\n\n      composite: device.createRenderPipeline({\n        layout: device.createPipelineLayout({ bindGroupLayouts: [compositeLayout] }),\n        vertex: {\n          module: this.context.createShaderModule(SHADERS.composite, 'composite'),\n          entryPoint: 'vs',\n        },\n        fragment: {\n          module: this.context.createShaderModule(SHADERS.composite, 'composite'),\n          entryPoint: 'fs',\n          targets: [{ format: this.context.getFormat() }],\n        },\n        primitive: { topology: 'triangle-list' },\n      }),\n    };\n  }\n\n  /**\n   * Create render targets for HDR pipeline\n   */\n  private createRenderTargets(width: number, height: number): void {\n    const mkTex = (format: GPUTextureFormat, usage: GPUTextureUsageFlags): GPUTexture => {\n      return this.context.getDevice().createTexture({\n        size: [width, height],\n        format,\n        usage: usage | GPUTextureUsage.TEXTURE_BINDING | GPUTextureUsage.RENDER_ATTACHMENT,\n      });\n    };\n\n    const hdr = mkTex(RENDER.HDR_FORMAT, GPUTextureUsage.TEXTURE_BINDING);\n    const depth = this.context.getDevice().createTexture({\n      size: [width, height],\n      format: RENDER.DEPTH_FORMAT,\n      usage: GPUTextureUsage.RENDER_ATTACHMENT,\n    });\n    const bloomA = mkTex(RENDER.HDR_FORMAT, GPUTextureUsage.TEXTURE_BINDING);\n    const bloomB = mkTex(RENDER.HDR_FORMAT, GPUTextureUsage.TEXTURE_BINDING);\n\n    this.renderTargets = {\n      hdr,\n      depth,\n      bloomA,\n      bloomB,\n      hdrView: hdr.createView(),\n      depthView: depth.createView(),\n      bloomAView: bloomA.createView(),\n      bloomBView: bloomB.createView(),\n    };\n  }\n\n  /**\n   * Create bind groups for all pipelines\n   */\n  private createBindGroups(): void {\n    if (!this.pipelines || !this.renderTargets) return;\n\n    const device = this.context.getDevice();\n    const posBuffer = this.buffers.positions instanceof GPUBuffer\n      ? this.buffers.positions\n      : (this.buffers.positions as { read: GPUBuffer }).read;\n\n    this.bindGroups = {\n      compute: device.createBindGroup({\n        layout: this.pipelines.compute.getBindGroupLayout(0),\n        entries: [\n          { binding: 0, resource: { buffer: this.buffers.uniforms } },\n          { binding: 1, resource: { buffer: this.buffers.orbitalElements } },\n          { binding: 2, resource: { buffer: posBuffer } },\n        ],\n      }),\n\n      stars: device.createBindGroup({\n        layout: this.pipelines.stars.getBindGroupLayout(0),\n        entries: [{ binding: 0, resource: { buffer: this.buffers.uniforms } }],\n      }),\n\n      earth: device.createBindGroup({\n        layout: this.pipelines.earth.getBindGroupLayout(0),\n        entries: [{ binding: 0, resource: { buffer: this.buffers.uniforms } }],\n      }),\n\n      atmosphere: device.createBindGroup({\n        layout: this.pipelines.atmosphere.getBindGroupLayout(0),\n        entries: [{ binding: 0, resource: { buffer: this.buffers.uniforms } }],\n      }),\n\n      satellites: device.createBindGroup({\n        layout: this.pipelines.satellites.getBindGroupLayout(0),\n        entries: [\n          { binding: 0, resource: { buffer: this.buffers.uniforms } },\n          { binding: 1, resource: { buffer: posBuffer } },\n        ],\n      }),\n\n      bloomThreshold: device.createBindGroup({\n        layout: this.pipelines.bloomThreshold.getBindGroupLayout(0),\n        entries: [\n          { binding: 0, resource: this.renderTargets.hdrView },\n          { binding: 1, resource: this.linearSampler },\n        ],\n      }),\n\n      bloomHorizontal: device.createBindGroup({\n        layout: this.pipelines.bloomBlur.getBindGroupLayout(0),\n        entries: [\n          { binding: 0, resource: { buffer: this.buffers.bloomUniforms.horizontal } },\n          { binding: 1, resource: this.renderTargets.bloomAView },\n          { binding: 2, resource: this.linearSampler },\n        ],\n      }),\n\n      bloomVertical: device.createBindGroup({\n        layout: this.pipelines.bloomBlur.getBindGroupLayout(0),\n        entries: [\n          { binding: 0, resource: { buffer: this.buffers.bloomUniforms.vertical } },\n          { binding: 1, resource: this.renderTargets.bloomBView },\n          { binding: 2, resource: this.linearSampler },\n        ],\n      }),\n\n      composite: device.createBindGroup({\n        layout: this.pipelines.composite.getBindGroupLayout(0),\n        entries: [\n          { binding: 0, resource: this.renderTargets.hdrView },\n          { binding: 1, resource: this.renderTargets.bloomAView },\n          { binding: 2, resource: this.linearSampler },\n        ],\n      }),\n    };\n  }\n\n  /**\n   * Handle resize\n   */\n  resize(width: number, height: number): void {\n    if (width === this.width && height === this.height) return;\n    \n    this.width = width;\n    this.height = height;\n    \n    // Destroy old textures\n    this.renderTargets?.hdr.destroy();\n    this.renderTargets?.depth.destroy();\n    this.renderTargets?.bloomA.destroy();\n    this.renderTargets?.bloomB.destroy();\n    \n    // Recreate\n    this.createRenderTargets(width, height);\n    this.createBindGroups();\n  }\n\n  /**\n   * Execute compute pass\n   */\n  encodeComputePass(encoder: GPUCommandEncoder): void {\n    if (!this.pipelines || !this.bindGroups) return;\n    \n    const pass = encoder.beginComputePass();\n    pass.setPipeline(this.pipelines.compute);\n    pass.setBindGroup(0, this.bindGroups.compute);\n    pass.dispatchWorkgroups(Math.ceil(CONSTANTS.NUM_SATELLITES / RENDER.WORKGROUP_SIZE));\n    pass.end();\n  }\n\n  /**\n   * Execute scene render pass\n   */\n  encodeScenePass(\n    encoder: GPUCommandEncoder,\n    earthVertexBuffer: GPUBuffer,\n    earthIndexBuffer: GPUBuffer,\n    earthIndexCount: number\n  ): void {\n    if (!this.pipelines || !this.bindGroups || !this.renderTargets) return;\n\n    const pass = encoder.beginRenderPass({\n      colorAttachments: [{\n        view: this.renderTargets.hdrView,\n        clearValue: { r: 0, g: 0, b: 0.02, a: 1 },\n        loadOp: 'clear',\n        storeOp: 'store',\n      }],\n      depthStencilAttachment: {\n        view: this.renderTargets.depthView,\n        depthClearValue: 1,\n        depthLoadOp: 'clear',\n        depthStoreOp: 'store',\n      },\n    });\n\n    // Stars\n    pass.setPipeline(this.pipelines.stars);\n    pass.setBindGroup(0, this.bindGroups.stars);\n    pass.draw(3);\n\n    // Earth\n    pass.setPipeline(this.pipelines.earth);\n    pass.setBindGroup(0, this.bindGroups.earth);\n    pass.setVertexBuffer(0, earthVertexBuffer);\n    pass.setIndexBuffer(earthIndexBuffer, 'uint32');\n    pass.drawIndexed(earthIndexCount);\n\n    // Atmosphere\n    pass.setPipeline(this.pipelines.atmosphere);\n    pass.setBindGroup(0, this.bindGroups.atmosphere);\n    pass.setVertexBuffer(0, earthVertexBuffer);\n    pass.setIndexBuffer(earthIndexBuffer, 'uint32');\n    pass.drawIndexed(earthIndexCount);\n\n    // Satellites\n    pass.setPipeline(this.pipelines.satellites);\n    pass.setBindGroup(0, this.bindGroups.satellites);\n    pass.draw(6, CONSTANTS.NUM_SATELLITES);\n\n    pass.end();\n  }\n\n  /**\n   * Execute bloom passes\n   */\n  encodeBloomPasses(encoder: GPUCommandEncoder): void {\n    if (!this.pipelines || !this.bindGroups || !this.renderTargets) return;\n\n    // Threshold\n    const thrPass = encoder.beginRenderPass({\n      colorAttachments: [{\n        view: this.renderTargets.bloomAView,\n        clearValue: { r: 0, g: 0, b: 0, a: 1 },\n        loadOp: 'clear',\n        storeOp: 'store',\n      }],\n    });\n    thrPass.setPipeline(this.pipelines.bloomThreshold);\n    thrPass.setBindGroup(0, this.bindGroups.bloomThreshold);\n    thrPass.draw(3);\n    thrPass.end();\n\n    // Horizontal blur\n    const hBlurPass = encoder.beginRenderPass({\n      colorAttachments: [{\n        view: this.renderTargets.bloomBView,\n        clearValue: { r: 0, g: 0, b: 0, a: 1 },\n        loadOp: 'clear',\n        storeOp: 'store',\n      }],\n    });\n    hBlurPass.setPipeline(this.pipelines.bloomBlur);\n    hBlurPass.setBindGroup(0, this.bindGroups.bloomHorizontal);\n    hBlurPass.draw(3);\n    hBlurPass.end();\n\n    // Vertical blur\n    const vBlurPass = encoder.beginRenderPass({\n      colorAttachments: [{\n        view: this.renderTargets.bloomAView,\n        clearValue: { r: 0, g: 0, b: 0, a: 1 },\n        loadOp: 'clear',\n        storeOp: 'store',\n      }],\n    });\n    vBlurPass.setPipeline(this.pipelines.bloomBlur);\n    vBlurPass.setBindGroup(0, this.bindGroups.bloomVertical);\n    vBlurPass.draw(3);\n    vBlurPass.end();\n  }\n\n  /**\n   * Execute composite pass\n   */\n  encodeCompositePass(encoder: GPUCommandEncoder, outputView: GPUTextureView): void {\n    if (!this.pipelines || !this.bindGroups) return;\n\n    const pass = encoder.beginRenderPass({\n      colorAttachments: [{\n        view: outputView,\n        clearValue: { r: 0, g: 0, b: 0, a: 1 },\n        loadOp: 'clear',\n        storeOp: 'store',\n      }],\n    });\n    pass.setPipeline(this.pipelines.composite);\n    pass.setBindGroup(0, this.bindGroups.composite);\n    pass.draw(3);\n    pass.end();\n  }\n\n  /**\n   * Get render targets\n   */\n  getRenderTargets(): RenderTargets | null {\n    return this.renderTargets;\n  }\n\n  /**\n   * Cleanup resources\n   */\n  destroy(): void {\n    this.renderTargets?.hdr.destroy();\n    this.renderTargets?.depth.destroy();\n    this.renderTargets?.bloomA.destroy();\n    this.renderTargets?.bloomB.destroy();\n    this.renderTargets = null;\n    this.pipelines = null;\n    this.bindGroups = null;\n  }\n}\n\nexport default RenderPipeline;\n"],"names":["UNIFORM_STRUCT","ORBITAL_CS","STARS_SHADER","EARTH_SHADER","ATM_SHADER","SAT_SHADER","BLOOM_THRESHOLD_SHADER","BLOOM_BLUR_SHADER","COMPOSITE_SHADER","SHADERS","RenderPipeline","context","buffers","__publicField","width","height","device","computeLayout","uniformLayout","uniformStorageLayout","bloomLayout","thresholdLayout","compositeLayout","earthVertexLayout","additiveBlend","RENDER","mkTex","format","usage","hdr","depth","bloomA","bloomB","posBuffer","_a","_b","_c","_d","encoder","pass","CONSTANTS","earthVertexBuffer","earthIndexBuffer","earthIndexCount","thrPass","hBlurPass","vBlurPass","outputView"],"mappings":"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"}
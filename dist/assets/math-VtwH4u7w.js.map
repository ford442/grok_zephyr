{"version":3,"file":"math-VtwH4u7w.js","sources":["../../src/utils/math.ts"],"sourcesContent":["/**\n * Grok Zephyr - Math Utilities\n * \n * Custom 3D math functions using column-major matrix convention\n * consistent with WebGPU.\n */\n\nimport type { Vec3, Vec4, Mat4 } from '@/types/index.js';\n\n/**\n * Create a 3D vector\n */\nexport function v3(x: number, y: number, z: number): Vec3 {\n  return [x, y, z];\n}\n\n/**\n * Create a 4D vector\n */\nexport function v4(x: number, y: number, z: number, w: number): Vec4 {\n  return [x, y, z, w];\n}\n\n/**\n * Vector length\n */\nexport function v3len(a: Vec3): number {\n  return Math.sqrt(a[0] ** 2 + a[1] ** 2 + a[2] ** 2);\n}\n\n/**\n * Normalize vector\n */\nexport function v3norm(a: Vec3): Vec3 {\n  const len = v3len(a) || 1;\n  return [a[0] / len, a[1] / len, a[2] / len];\n}\n\n/**\n * Cross product\n */\nexport function v3cross(a: Vec3, b: Vec3): Vec3 {\n  return [\n    a[1] * b[2] - a[2] * b[1],\n    a[2] * b[0] - a[0] * b[2],\n    a[0] * b[1] - a[1] * b[0],\n  ];\n}\n\n/**\n * Dot product\n */\nexport function v3dot(a: Vec3, b: Vec3): number {\n  return a[0] * b[0] + a[1] * b[1] + a[2] * b[2];\n}\n\n/**\n * Vector subtraction\n */\nexport function v3sub(a: Vec3, b: Vec3): Vec3 {\n  return [a[0] - b[0], a[1] - b[1], a[2] - b[2]];\n}\n\n/**\n * Vector addition\n */\nexport function v3add(a: Vec3, b: Vec3): Vec3 {\n  return [a[0] + b[0], a[1] + b[1], a[2] + b[2]];\n}\n\n/**\n * Vector scaling\n */\nexport function v3scale(a: Vec3, s: number): Vec3 {\n  return [a[0] * s, a[1] * s, a[2] * s];\n}\n\n/**\n * Linear interpolation between vectors\n */\nexport function v3lerp(a: Vec3, b: Vec3, t: number): Vec3 {\n  return [\n    a[0] + (b[0] - a[0]) * t,\n    a[1] + (b[1] - a[1]) * t,\n    a[2] + (b[2] - a[2]) * t,\n  ];\n}\n\n/**\n * Distance between two vectors\n */\nexport function v3dist(a: Vec3, b: Vec3): number {\n  return v3len(v3sub(a, b));\n}\n\n/**\n * Create identity matrix\n */\nexport function mat4identity(): Mat4 {\n  return new Float32Array([\n    1, 0, 0, 0,\n    0, 1, 0, 0,\n    0, 0, 1, 0,\n    0, 0, 0, 1,\n  ]);\n}\n\n/**\n * Create look-at matrix (column-major)\n * \n * Creates a view matrix looking from 'eye' toward 'target'\n * with 'up' defining the camera's up direction.\n */\nexport function mat4lookAt(eye: Vec3, target: Vec3, up: Vec3): Mat4 {\n  const f = v3norm(v3sub(target, eye));\n  const r = v3norm(v3cross(f, up));\n  const u = v3cross(r, f);\n\n  return new Float32Array([\n    r[0], u[0], -f[0], 0,\n    r[1], u[1], -f[1], 0,\n    r[2], u[2], -f[2], 0,\n    -v3dot(r, eye), -v3dot(u, eye), v3dot(f, eye), 1,\n  ]);\n}\n\n/**\n * Create perspective projection matrix (WebGPU style)\n * \n * WebGPU uses z in [0, 1] range (different from OpenGL's [-1, 1])\n */\nexport function mat4persp(fovy: number, aspect: number, near: number, far: number): Mat4 {\n  const f = 1 / Math.tan(fovy / 2);\n  const range = 1 / (near - far);\n\n  return new Float32Array([\n    f / aspect, 0, 0, 0,\n    0, f, 0, 0,\n    0, 0, far * range, -1,\n    0, 0, near * far * range, 0,\n  ]);\n}\n\n/**\n * Matrix multiplication (column-major)\n * \n * Returns a * b (apply b first, then a)\n */\nexport function mat4mul(a: Mat4, b: Mat4): Mat4 {\n  const out = new Float32Array(16);\n  \n  for (let c = 0; c < 4; c++) {\n    for (let r = 0; r < 4; r++) {\n      let sum = 0;\n      for (let k = 0; k < 4; k++) {\n        sum += a[r + k * 4] * b[k + c * 4];\n      }\n      out[r + c * 4] = sum;\n    }\n  }\n  \n  return out;\n}\n\n/**\n * 4x4 matrix inversion (column-major)\n * \n * Standard cofactor expansion method.\n */\nexport function mat4inv(m: Mat4): Mat4 {\n  const out = new Float32Array(16);\n  \n  const [\n    m00, m10, m20, m30,\n    m01, m11, m21, m31,\n    m02, m12, m22, m32,\n    m03, m13, m23, m33,\n  ] = m;\n\n  const det =\n    m00 * (m11 * (m22 * m33 - m23 * m32) - m12 * (m21 * m33 - m23 * m31) + m13 * (m21 * m32 - m22 * m31))\n    - m01 * (m10 * (m22 * m33 - m23 * m32) - m12 * (m20 * m33 - m23 * m30) + m13 * (m20 * m32 - m22 * m30))\n    + m02 * (m10 * (m21 * m33 - m23 * m31) - m11 * (m20 * m33 - m23 * m30) + m13 * (m20 * m31 - m21 * m30))\n    - m03 * (m10 * (m21 * m32 - m22 * m31) - m11 * (m20 * m32 - m22 * m30) + m12 * (m20 * m31 - m21 * m30));\n\n  if (!det) return m;\n  \n  const di = 1 / det;\n\n  out[0] = (m11 * (m22 * m33 - m23 * m32) - m12 * (m21 * m33 - m23 * m31) + m13 * (m21 * m32 - m22 * m31)) * di;\n  out[1] = (-m01 * (m22 * m33 - m23 * m32) + m02 * (m21 * m33 - m23 * m31) - m03 * (m21 * m32 - m22 * m31)) * di;\n  out[2] = (m01 * (m12 * m33 - m13 * m32) - m02 * (m11 * m33 - m13 * m31) + m03 * (m11 * m32 - m12 * m31)) * di;\n  out[3] = (-m01 * (m12 * m23 - m13 * m22) + m02 * (m11 * m23 - m13 * m21) - m03 * (m11 * m22 - m12 * m21)) * di;\n  out[4] = (-m10 * (m22 * m33 - m23 * m32) + m12 * (m20 * m33 - m23 * m30) - m13 * (m20 * m32 - m22 * m30)) * di;\n  out[5] = (m00 * (m22 * m33 - m23 * m32) - m02 * (m20 * m33 - m23 * m30) + m03 * (m20 * m32 - m22 * m30)) * di;\n  out[6] = (-m00 * (m12 * m33 - m13 * m32) + m02 * (m10 * m33 - m13 * m30) - m03 * (m10 * m32 - m12 * m30)) * di;\n  out[7] = (m00 * (m12 * m23 - m13 * m22) - m02 * (m10 * m23 - m13 * m20) + m03 * (m10 * m22 - m12 * m20)) * di;\n  out[8] = (m10 * (m21 * m33 - m23 * m31) - m11 * (m20 * m33 - m23 * m30) + m13 * (m20 * m31 - m21 * m30)) * di;\n  out[9] = (-m00 * (m21 * m33 - m23 * m31) + m01 * (m20 * m33 - m23 * m30) - m03 * (m20 * m31 - m21 * m30)) * di;\n  out[10] = (m00 * (m11 * m33 - m13 * m31) - m01 * (m10 * m33 - m13 * m30) + m03 * (m10 * m31 - m11 * m30)) * di;\n  out[11] = (-m00 * (m11 * m23 - m13 * m21) + m01 * (m10 * m23 - m13 * m20) - m03 * (m10 * m21 - m11 * m20)) * di;\n  out[12] = (-m10 * (m21 * m32 - m22 * m31) + m11 * (m20 * m32 - m22 * m30) - m12 * (m20 * m31 - m21 * m30)) * di;\n  out[13] = (m00 * (m21 * m32 - m22 * m31) - m01 * (m20 * m32 - m22 * m30) + m02 * (m20 * m31 - m21 * m30)) * di;\n  out[14] = (-m00 * (m11 * m32 - m12 * m31) + m01 * (m10 * m32 - m12 * m30) - m02 * (m10 * m31 - m11 * m30)) * di;\n  out[15] = (m00 * (m11 * m22 - m12 * m21) - m01 * (m10 * m22 - m12 * m20) + m02 * (m10 * m21 - m11 * m20)) * di;\n\n  return out;\n}\n\n/**\n * Extract frustum planes from view-projection matrix\n * \n * Returns 6 planes in format [nx, ny, nz, d] where\n * the plane equation is nx*x + ny*y + nz*z + d = 0\n */\nexport function extractFrustum(vp: Mat4): Float32Array[] {\n  // Extract rows from column-major matrix\n  const row = (i: number): number[] => [vp[i], vp[i + 4], vp[i + 8], vp[i + 12]];\n  const r0 = row(0);\n  const r1 = row(1);\n  const r2 = row(2);\n  const r3 = row(3);\n\n  const planes = [\n    [r3[0] + r0[0], r3[1] + r0[1], r3[2] + r0[2], r3[3] + r0[3]], // Left\n    [r3[0] - r0[0], r3[1] - r0[1], r3[2] - r0[2], r3[3] - r0[3]], // Right\n    [r3[0] + r1[0], r3[1] + r1[1], r3[2] + r1[2], r3[3] + r1[3]], // Bottom\n    [r3[0] - r1[0], r3[1] - r1[1], r3[2] - r1[2], r3[3] - r1[3]], // Top\n    [r2[0], r2[1], r2[2], r2[3]],                                  // Near (WebGPU z=0)\n    [r3[0] - r2[0], r3[1] - r2[1], r3[2] - r2[2], r3[3] - r2[3]], // Far\n  ];\n\n  // Normalize planes\n  return planes.map((p) => {\n    const len = Math.sqrt(p[0] ** 2 + p[1] ** 2 + p[2] ** 2) || 1;\n    return new Float32Array([p[0] / len, p[1] / len, p[2] / len, p[3] / len]);\n  });\n}\n\n/**\n * Spherical to Cartesian coordinates\n */\nexport function sphericalToCartesian(\n  radius: number,\n  theta: number,\n  phi: number\n): Vec3 {\n  return [\n    radius * Math.sin(theta) * Math.cos(phi),\n    radius * Math.sin(theta) * Math.sin(phi),\n    radius * Math.cos(theta),\n  ];\n}\n\n/**\n * Cartesian to spherical coordinates\n */\nexport function cartesianToSpherical(x: number, y: number, z: number): {\n  radius: number;\n  theta: number;\n  phi: number;\n} {\n  const radius = Math.sqrt(x * x + y * y + z * z);\n  return {\n    radius,\n    theta: Math.acos(z / radius),\n    phi: Math.atan2(y, x),\n  };\n}\n\n/**\n * Generate UV sphere geometry\n */\nexport function genSphere(\n  radius: number,\n  rings: number,\n  segments: number\n): {\n  vertices: Float32Array;\n  normals: Float32Array;\n  indices: Uint32Array;\n} {\n  const verts: number[] = [];\n  const norms: number[] = [];\n  const idxs: number[] = [];\n\n  for (let r = 0; r <= rings; r++) {\n    const theta = (r * Math.PI) / rings;\n    const sinTheta = Math.sin(theta);\n    const cosTheta = Math.cos(theta);\n\n    for (let s = 0; s <= segments; s++) {\n      const phi = (s * 2 * Math.PI) / segments;\n      const x = radius * sinTheta * Math.cos(phi);\n      const y = radius * sinTheta * Math.sin(phi);\n      const z = radius * cosTheta;\n\n      verts.push(x, y, z);\n      norms.push(x / radius, y / radius, z / radius);\n    }\n  }\n\n  for (let r = 0; r < rings; r++) {\n    for (let s = 0; s < segments; s++) {\n      const a = r * (segments + 1) + s;\n      const b = a + segments + 1;\n      idxs.push(a, b, a + 1, b, b + 1, a + 1);\n    }\n  }\n\n  return {\n    vertices: new Float32Array(verts),\n    normals: new Float32Array(norms),\n    indices: new Uint32Array(idxs),\n  };\n}\n\n/**\n * Clamp value to range\n */\nexport function clamp(value: number, min: number, max: number): number {\n  return Math.max(min, Math.min(max, value));\n}\n\n/**\n * Smoothstep interpolation\n */\nexport function smoothstep(edge0: number, edge1: number, x: number): number {\n  const t = clamp((x - edge0) / (edge1 - edge0), 0, 1);\n  return t * t * (3 - 2 * t);\n}\n\n/**\n * Hash function for deterministic randomness\n */\nexport function hash(n: number): number {\n  return Math.abs(Math.sin(n * 12.9898 + 78.233) * 43758.5453) % 1;\n}\n\n/**\n * 2D hash function\n */\nexport function hash2(x: number, y: number): number {\n  return Math.abs(Math.sin(x * 12.9898 + y * 78.233) * 43758.5453) % 1;\n}\n\nexport default {\n  v3, v4, v3len, v3norm, v3cross, v3dot, v3sub, v3add, v3scale,\n  v3lerp, v3dist, mat4identity, mat4lookAt, mat4persp, mat4mul, mat4inv,\n  extractFrustum, sphericalToCartesian, cartesianToSpherical, genSphere,\n  clamp, smoothstep, hash, hash2,\n};\n"],"names":["v3len","a","v3norm","len","v3cross","b","v3dot","v3sub","v3add","v3scale","s","mat4lookAt","eye","target","up","f","r","u","mat4persp","fovy","aspect","near","far","range","extractFrustum","vp","row","i","r0","r1","r2","r3","p","genSphere","radius","rings","segments","verts","norms","idxs","theta","sinTheta","cosTheta","phi","x","y","z"],"mappings":"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"}